<!DOCTYPE html>
<html>
  <head>
    <title>Assignment 4</title>
    <script  src="https://threejs.org/build/three.js"></script>
    <script  src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <script  src= "https://threejs.org/examples/js/loaders/OBJLoader.js"> </script>
    <script src= "https://threejs.org/examples/js/loaders/MTLLoader.js"> </script>
    <script src='https://threejs.org/examples/js/libs/dat.gui.min.js'></script>


    <script id="vertexShader" type="x-shader/x-vertex">
      precision mediump float;
      attribute vec3 position;
      attribute vec3 normal;

      uniform mat4 projectionMatrix;
      uniform mat4 modelViewMatrix;
      uniform mat4 viewMatrix;
      uniform mat3 normalMatrix;
      uniform vec3 lightPos;
      uniform vec3 cameraPosition;

      varying vec3 normal_new;
      varying vec3 vertex_pos;
      varying vec3 light_pos;

      void main(){
        normal_new = normalize(normalMatrix * normal);
        
        vec4 light_temp = viewMatrix * vec4(lightPos, 1.0);
        light_pos = light_temp.xyz;

        vec4 vert_temp = modelViewMatrix * vec4(position, 1.0);
        vertex_pos = vert_temp.xyz;
      
        gl_Position = projectionMatrix * vert_temp;

      }
    </script>
  
    <script id="fragmentShader" type="x-shader/x-fragment">
      precision mediump float;

      uniform mat4 viewMatrix;
      
      varying vec3 normal_new;        //Position fixed in vertex shader
      varying vec3 vertex_pos;        //Position fixed in vertex shader
      varying vec3 light_pos;
  
      uniform vec3 lightPos;           
      uniform vec3 cameraPosition;    

      uniform float lightPower;
      uniform vec3 specColor;
      uniform vec3 materialColor;
      uniform float shininess;
      
      void main() {

        //vec4 light_temp =  vec4(lightPos, 1.0);    //Position of Light in view space
        //vec4 camera_temp = viewMatrix * vec4(cameraPosition, 1.0);

        //vec3 light_pos = normalize(light_temp.xyz);
        //vec3 camera_pos = normalize(camera_temp.xyz);
        vec3 normal = normalize(normal_new);

        vec3 L = normalize(light_pos - vertex_pos);
        vec3 V = normalize(-vertex_pos);
        vec3 H = normalize(L + V);

        vec3 colorLinear = vec3(0.0,0.0,0.0);

        vec3 lambert_color = materialColor * clamp(dot(normal, L), 0.0, 1.0);
        vec3 phong_color = specColor * pow(clamp(dot(normal, H), 0.0, 1.0), shininess);


        if(dot(normal, L) > 0.0){
          colorLinear =  normalize(lightPower * (lambert_color + phong_color));
        }
        gl_FragColor = vec4(colorLinear, 1.0);
      }
    </script>

    <script>
      "use strict"
      function mainFunction(){

        function sleepFor( sleepDuration ){
            var now = new Date().getTime();
            while(new Date().getTime() < now + sleepDuration){ /* do nothing */ } 
        };

        let inwidth = window.innerWidth-window.innerWidth*.02;
        let inheight = window.innerHeight - window.innerHeight*.15;
        let renderer = new THREE.WebGLRenderer( { antialias: true } );

        renderer.setSize( inwidth, inheight );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setClearColor (0x888888, 1);
        document.body.appendChild( renderer.domElement );

        let scene = new THREE.Scene();

        let aspect = window.innerWidth / window.innerHeight;
        let camera = new THREE.PerspectiveCamera( 75, aspect, .01, 100);

        camera.position.z = 15;
        scene.add(camera);

        let light = new THREE.AmbientLight(0xffffff);
        scene.add(light);
        let light2 = new THREE.PointLight(0,0,0);
        scene.add(light2);

        let material = new THREE.MeshNormalMaterial();

        let geometry = new THREE.BoxGeometry(1,1,1);
        let cube = new THREE.Mesh(geometry, material);
                
        let render = function (a,b) {
          renderer.render( scene, camera );
        };

        let cameraControls = new THREE.OrbitControls( camera, renderer.domElement  );
        cameraControls.addEventListener("change",render,false)
        
        let flag = 0;
        let positions = [-9, -7, -5, -3, -1, 1, 3, 5, 7, 9];
        let numbers = [];
        let cubes = [];
        let swaps = [];

        var num_elements = {
              NumberElements: 10,
              recorded_value: 10,
              setNumElements: function() {
                this.recorded_value = this.NumberElements;
                if(this.recorded_value > 10){
                  alert("Max Elements is 10");
                  this.recorded_value = 10;
                }
                generate_elements();
                flag = 1;
              },
              placeElements: function(){
                createAndPlace();
              },
              sortList: function(){
                selectionSort();
              }
        };

        var gui = new dat.GUI();
        gui.add(num_elements, 'NumberElements');
        gui.add(num_elements, 'setNumElements');
        gui.add(num_elements, 'placeElements');
        gui.add(num_elements, 'sortList');

        function generate_elements(){
          numbers = [];
          if(flag == 1){
            gui.destroy();
            gui = new dat.GUI();
            gui.add(num_elements, 'NumberElements');
            gui.add(num_elements, 'setNumElements');
            gui.add(num_elements, 'placeElements');
            gui.add(num_elements, 'sortList');
          }
          gui.addFolder('Elements');
          for(let i = 0; i < num_elements.recorded_value; i++)
          {
            numbers.push({value: Math.round(Math.random()*99+1)});
            gui.add(numbers[i], 'value', 1, 100);
          }
        };

        function createAndPlace(){
          for(let i = 0; i < cubes.length; i++){
            scene.remove(cubes[i]);
          }
          cubes = [];
          for(let i = 0; i < num_elements.recorded_value; i++){
            cubes.push(new THREE.Mesh(new THREE.BoxGeometry(1,numbers[i].value/10,1), new THREE.MeshPhongMaterial({color:0x2194ce})));
            cubes[i].position.x = i*2 - 9;
            scene.add(cubes[i]);
          }
          render();
        };
        const sleep = (milliseconds) => {
          return new Promise(resolve => setTimeout(resolve, milliseconds))
        }

        function swap(i, j){
        };
        // 0xff0000 red
        // 0xff00ff purple
        // 0xffff00 yellow
        // render(cubes[0].material.color.setHex(0xff0000));

        function selectionSort(){
          for(let i = 0; i < cubes.length; i++){
            let min_idx = i;
            let prev_min = i;
            for(let j = i; j < cubes.length; j++){
              if(numbers[j].value < numbers[min_idx].value){
                prev_min = min_idx;
                min_idx = j;
              }
              sleep(7000*i + 700*j).then(() => {
                for(let k = i; k < cubes.length; k++){
                  cubes[k].material.color.setHex(0x2194ce);
                }
                if (j > i){
                  cubes[j-1].material.color.setHex(0x2194ce);
                }
                if(j >= i){
                  cubes[j].material.color.setHex(0xff00ff);
                }
                let temp_array = numbers.slice(i, j);
                console.log(temp_array.length);
                console.log(Math.min(temp_array));
                //console.log(temp_array.indexOf(Math.min(temp_array))+i);
                //cubes[temp_array.indexOf(Math.min(temp_array))+i].material.color.setHex(0xff0000);
                render();
              });
              prev_min = min_idx;
            }
            let temp1 = numbers[i];
            numbers[i] = numbers[min_idx];
            numbers[min_idx] = temp1;

            sleep(7500*i + 7000).then(() => {
              for(let k = i+1; k < cubes.length; k++){
                cubes[k].material.color.setHex(0x2194ce);
              }
              cubes[i].position.x = positions[min_idx];
              cubes[min_idx].position.x = positions[i];
              let temp = cubes[i];
              cubes[i] = cubes[min_idx];
              cubes[min_idx] = temp;
              cubes[i].material.color.setHex(0xffff00);
              render();
            });
          }
        };

      }
    </script>
  </head>
  <body onload="mainFunction();">
  <h1>Cameron Taylor  ID = 4136334</h1>
  </body>
</html>
